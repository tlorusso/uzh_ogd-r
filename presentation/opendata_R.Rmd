---
title: "Opendata & R"
subtitle: ""
author: "Thomas Lo Russo"
date: "Universität Zürich </br> `r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: lib/zh.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
---


# Opendata & R

- __R__ (and similar open software) lowers the barriers and costs to make data analysis __repetable and reproducible__.

- __Open data__ ensures that everyone can access the same information for free (ideally, in a well structured manner)

### __Democratization of data & tools for analysis__

When doing research, it's not alway possible to use open data (sensitive data, privacy / security)

But when possible : unbeatable DUO (reproducibility paradise)!

A Combination that allows collaboration on unprecedentend scale  

---

# Trust in Government Information

How to ... trust ? 

- Reliability 
- Timeliness
- Traceablity

## OPEN GOVERNMENT DATA

---
class: inverse, center, middle

# What is R ?

<img src="rknife.png" alt="drawing" width="50%"/>

---
class: inverse centre middle

# R & Open Data 

### Showcase : Real Time Data-Service of popular vote results in the canton Zurich

---

#Daten in R lesen
```{r,message=FALSE,warning=FALSE}
if (!require(pacman)) install.packages(pacman)

pacman::p_load(sf,tidyverse,ggrepel,tmap,tmaptools,statR)

library(tidyverse)
library(purrr)

# get json via webservice
data <- jsonlite::fromJSON("http://www.wahlen.zh.ch/abstimmungen/2016_09_25/viewer_download.php")

# transform nested list into dataframe
data <- data %>% 
  map_dfr(bind_rows) %>% 
  unnest(VORLAGEN)

```

---

```{r,message=FALSE,warning=FALSE, message=FALSE, dpi=100, fig.height=2}
# install.packages("ggridges")
library(ggridges)

data$VORLAGE_NAME <- factor(data$VORLAGE_NAME, labels = c("Grüne Wirtschaft", "AHV Plus", "NDG", "Bezahlbare Kinderbetreuung"))

ggplot(data,aes(as.numeric(JA_PROZENT),VORLAGE_NAME))+
    geom_density_ridges(scale = 0.8, fill="steelblue") + 
  theme_ridges() +
    scale_y_discrete(expand = c(0.01, 0)) + 
  scale_x_continuous(limits = c(0, 100),breaks=seq(0,100,25))+
  labs(x="Ja-Anteil (%)", y="Vorlage")
```

---

.pull-left[

```{r,message=FALSE,warning=FALSE}

# get shapefile from here
# http://www.web.statistik.zh.ch/cms_basiskarten/gen_Gemeinde_2018/GEN_A4_GEMEINDEN_SEEN_2018_F.zip

#Gemeindeshapes
gemeinden<- sf::read_sf("GEN_A4_GEMEINDEN_SEEN_2018_F", stringsAsFactors = FALSE)

#join municipality-infos to points
mapdata <- left_join(gemeinden,data, by=c("BFS")) 

map <- ggplot(mapdata %>% filter(!is.na(JA_PROZENT)))+
  geom_sf(aes(fill=as.numeric(JA_PROZENT)))+
  facet_wrap(~VORLAGE_ID)
```
]

--

.pull-right[

```{r, dpi=120}
map
```

]

---

.pull-left[

```{r,message=FALSE,warning=FALSE, dpi=125}

#Labels - Kurzbezeichnung 
mapdata <- left_join(gemeinden,data, by=c("BFS"))

mapnew <- ggplot(mapdata %>% filter(!is.na(JA_PROZENT)))+
              geom_sf(aes(fill=as.numeric(JA_PROZENT)),color="white")+
              facet_wrap(~VORLAGE_NAME,labeller = label_value)+
              coord_sf(datum = NA)+
              labs(fill="Ja (in %)")+
              theme_void()+
              scale_fill_gradient2(midpoint=50)+
              guides(fill = guide_colourbar(barwidth = 0.5, barheight = 10))
```
]

--

.pull-right[

```{r,echo=FALSE, dpi=120}
mapnew 

```

]

---

```{r}
# pacman::p_load(units,sf,osmdata)
# 
# # getbb("Kanton Zürich")
# 
# q0 <- opq(bbox = c(8.35768, 47.15944,8.984941,47.694472))
# 
# # extract boundaries of the Canton of Zurich via wikidati URI
# q1 <- add_osm_feature(opq = q0, key = 'wikidata', value = "Q11943")
# # retrieve the data
# res1 <- osmdata_sf(q1)
# #get geometry
# zh <- st_geometry(res1$osm_multipolygons)
# 
# # extract Bars & Pubs
# q6 <- add_osm_feature(opq = q0, key = 'amenity', value = "kindergarten")
# bars <- osmdata_sf(q6)
# bars_zh<- st_geometry(bars$osm_points)

# plot the bars in the canton of Zurich

# tmap::qtm(bars_zh)

# mapview::mapview(bars_zh)

```

---
class: inverse, center, middle

.pull-left[

```{r}
# https://opendata.swiss/de/dataset/altersquotient
ageq <- read.csv("http://www.web.statistik.zh.ch/ogd/data/KANTON_ZUERICH_95.csv", sep=";", encoding="UTF8") %>%
  select(BFS = `ï..BFS_NR`, INDIKATOR_VALUE,INDIKATOR_JAHR,GEBIET_NAME) %>% 
  dplyr::filter(INDIKATOR_JAHR==2017 & BFS != 0)

plotdata <- ageq %>% 
            left_join(data %>% filter(VORLAGE_NAME=="Bezahlbare Kinderbetreuung"), by=c("BFS")) %>% 
            mutate_at(vars(JA_PROZENT,INDIKATOR_VALUE),as.numeric) %>% 
            as.data.frame()


library(echarts4r)
library(tidyverse)


plotdata %>% 
  echarts4r::e_charts(GEBIET_NAME) %>% 
  echarts4r::e_charts(JA_PROZENT, INDIKATOR_VALUE)




ggplot(plotdata, aes(as.numeric(JA_PROZENT), INDIKATOR_VALUE))+
      geom_point()+
      theme_minimal()

```
]

--

.pull-right[
```{r}
# https://opendata.swiss/de/dataset/nrw-wahleranteil-sp
sp <- read.csv("http://www.web.statistik.zh.ch/ogd/data/KANTON_ZUERICH_124.csv", sep=";", encoding="UTF8") %>%
  select(BFS = `ï..BFS_NR`, INDIKATOR_VALUE,INDIKATOR_JAHR) %>% 
  dplyr::filter(INDIKATOR_JAHR==2015 & BFS != 0)

plotdata <-sp %>% 
  left_join(data %>% filter(VORLAGE_NAME=="Bezahlbare Kinderbetreuung"), by=c("BFS"))

ggplot(plotdata, aes(as.numeric(JA_PROZENT), INDIKATOR_VALUE))+
      geom_point()+
      theme_minimal()+
      geom_smooth()

```
]

---



